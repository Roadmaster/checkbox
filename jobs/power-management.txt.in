plugin: manual
name: power-management/shutdown-boot
_description:
 PURPOSE:
     This test will check your system shutdown/booting cycle
 STEPS:
     1. Shutdown your machine
     2. Boot your machine
     3. Repeat steps 1 and 2 at least 5 times
 VERIFICATION:
     Did the system shutdown and rebooted correctly?

plugin: shell
name: power-management/fwts_wakealarm
user: root
_description: Test ACPI Wakealarm (fwts wakealarm)
requires:
 package.name == 'linux'
 package.name == 'fwts'
command: fwts_test -w -l $CHECKBOX_DATA/fwts-wakealarm.log

plugin: attachment
name: power-management/fwts_wakealarm-log-attach
depends: power-management/fwts_wakealarm
_description: Attach log from fwts wakealarm test
requires:
 package.name == 'linux'
 package.name == 'fwts'
command: [ -e ${CHECKBOX_DATA}/fwts-wakealarm.log ] && cat ${CHECKBOX_DATA}/fwts-wakealarm.log

plugin: manual
name: power-management/poweroff
depends: power-management/fwts_wakealarm
user: root
requires:
 package.name == 'upstart'
 package.name == 'fwts'
command: pm_test poweroff --log-level=debug --log-dir=$CHECKBOX_DATA
_description:
 PURPOSE:
  This test will check the system's ability to power-off and boot.
 STEPS:
  1: Select "Test" to begin.
  2: The machine will shut down.
  3: Power the machine back on.
  4: After rebooting, wait for the test prompts to inform you that the test is complete.
  5: Once the test has completed, restart checkbox and select Re-Run when prompted
 VERIFICATION:
  If the machine successfully shuts down and boots, select Yes then select Next.

plugin: attachment
name: power-management/poweroff-log-attach
command: tar cvfz power-management_poweroff.tgz $CHECKBOX_DATA/*poweroff.1.log && cat $CHECKBOX_DATA/power-management_poweroff.tgz
_description:
 This will attach any logs from the power-management/poweroff test to the results.

plugin: manual
name: power-management/reboot
user: root
requires:
 package.name == 'upstart'
 package.name == 'fwts'
command: pm_test reboot --log-level=debug --log-dir=$CHECKBOX_DATA
_description:
 PURPOSE:
  This test will check the system's ability to reboot cleanly.
 STEPS:
  1: Select "Test" to begin.
  2: The machine will reboot.
  3: After rebooting, wait for the test prompts to inform you that the test is complete.
  4: Once the test has completed, restart checkbox and select Re-Run when prompted
 VERIFICATION:
  If the machine successfully reboots, select Yes then select Next.

plugin: attachment
name: power-management/reboot-log-attach
command: tar cvfz power-management_reboot.tgz $CHECKBOX_DATA/*reboot.1.log && cat $CHECKBOX_DATA/power-management_reboot.tgz
_description:
 This will attach any logs from the power-management/reboot test to the results.

plugin: manual
name: power-management/lid
_description:
 PURPOSE:
     This test will check your lid sensors
 STEPS:
     1. Close your laptop lid
 VERIFICATION:
    Does closing your laptop lid cause your system to suspend?

plugin: manual
name: power-management/lid_close
requires: device.product == 'Lid Switch' and package.name == 'linux'
command:
 for i in `seq 20`; do
  state=`cat /proc/acpi/button/lid/LID/state | awk '{print $2}'`
  [ "$state" = "closed" ] && exit 0 || sleep 0.5
 done
 exit 1
_description:
 PURPOSE:
     This test will check your lid sensors
 STEPS:
     1. Click "Test"
     2. Close and open the lid
 VERIFICATION:
     Did the screen turn off while the lid was closed?

plugin: manual
name: power-management/lid_open
requires: device.product == 'Lid Switch' and package.name == 'linux'
command:
 for i in `seq 20`; do
  state=`cat /proc/acpi/button/lid/LID/state | awk '{print $2}'`
  [ "$state" = "open" ] && exit 0 || sleep 0.5
 done
 exit 1
_description:
 PURPOSE:
     This test will check your lid sensors
 STEPS:
     1. Click "Test"
     2. Close the lid
     3. Wait 5 seconds with the lid closed
     4. Open the lid
 VERIFICATION:
     Did the system resume when the lid was opened?

plugin: shell
name: power-management/rtc
requires: package.name == 'linux'
command:
 test -e /dev/rtc || ( echo "ERROR: Real Time Clock not found" >&2 && exit 1 )
_description:
 Make sure that the RTC (Real-Time Clock) device exists.

plugin: shell
name: power-management/tickless_idle
requires: package.name == 'linux'
_description: Check to see if CONFIG_NO_HZ is set in the kernel (this is just a simple regression check)
command:
 zgrep 'CONFIG_NO_HZ=y' /boot/config-`uname -r` >/dev/null 2>&1 || ( echo "WARNING: Tickless Idle is NOT set" >&2 && exit 1 )
